# ✅ A2.9 — Consolidated Ownership Matrix (ALL Tables → Owner Module)

**Phase:** Phase-5  
**Category:** A — Freeze Gate Verification  
**Item:** A2.9  
**Status:** ✅ COMPLETED (Freeze-ready)  
**Date:** 2026-01-27  
**Purpose:** Provide a single authoritative ownership map for every SPEC-5 table, consolidating A2.2–A2.8 into one reviewable artifact for freeze approval.

⸻

## 1) Canonical Rule (Locked)

- **One table → one primary owner module**
- **Owner controls:** schema changes, validations, write APIs, integrity
- **Non-owners:** read-only via FKs / services unless explicitly approved
- **Cross-cutting writers (AUDIT):** write only through owner interface

⸻

## 2) Master Ownership Matrix (Alphabetical)

| Table | Primary Owner | Write Authority | Notes / Guardrails |
|-------|---------------|-----------------|-------------------|
| `ai_call_logs` | AI | AI only | Phase-5: schema reservation only; advisory, non-authoritative |
| `ai_feedback_logs` (opt) | AI | AI only | Reserved for later phases |
| `audit_logs` | AUDIT | Via AuditLogger | Append-only; tenant-scoped |
| `attributes` | CIM | CIM only | Canonical attribute definitions |
| `attribute_options` | CIM | CIM only | Enumerations for attributes |
| `categories` | CIM | CIM only | `(tenant_id, code)` unique |
| `catalog_skus` | CIM | CIM only | L2 SKU identity (SKU-pure) |
| `cost_heads` | SHARED | SHARED only | Precedence: Item → Product → System |
| `discount_rules` | QUO | QUO only | Quotation-scoped discount rules |
| `import_batches` (if exists) | PRICING | PRICING only | Import lineage |
| `import_approval_queue` (if exists) | PRICING | PRICING only | Governance |
| `l1_attributes` | CIM | CIM only | KVU attributes |
| `l1_intent_lines` | CIM | CIM only | Engineering meaning (L1) |
| `l1_line_groups` | CIM | CIM only | Grouping |
| `l1_l2_mappings` | CIM | CIM only | Many-to-one allowed (G-08) |
| `makes` | CIM | CIM only | OEM master |
| `master_boms` | MBOM | MBOM only | Template headers |
| `master_bom_items` | MBOM | MBOM only | **G-01:** `product_id` MUST be NULL |
| `price_lists` | PRICING | PRICING only | Price list headers |
| `prices` (transitional) | PRICING | PRICING only | Legacy; canonical truth is `sku_prices` |
| `products` (transitional) | CIM | CIM only | Transitional L2 binding today |
| `product_types` | CIM | CIM only | Normalized type classification |
| `quote_boms` | QUO | QUO only | Copy-never-link from MBOM |
| `quote_bom_items` | QUO | QUO only | **G-02/05/06/07/08** enforced |
| `quote_panels` | QUO | QUO only | Workspace container |
| `quotations` | QUO | QUO only | Policy-1 preview/apply |
| `quotation_revisions` (if exists) | QUO | QUO only | Optional revision tracking |
| `roles` | AUTH | AUTH only | Tenant-scoped RBAC |
| `series` | CIM | CIM only | OEM series |
| `sku_prices` | PRICING | PRICING only | Append-only price truth |
| `subcategories` | CIM | CIM only | Taxonomy |
| `tax_profiles` | TAX | TAX only | Tax masters |
| `tenants` | AUTH | AUTH only | Isolation root |
| `user_roles` | AUTH | AUTH only | RBAC mapping |
| `users` | AUTH | AUTH only | Identity |

**Legend:** AUTH / CIM / MBOM / QUO / PRICING / TAX / AUDIT / AI / SHARED

⸻

## 3) Module-Grouped View (Reviewer Friendly)

### AUTH Module
- `tenants`
- `users`
- `roles`
- `user_roles`

### CIM Module (Component / Item Master)
- `categories`
- `subcategories`
- `product_types`
- `attributes`
- `attribute_options`
- `makes`
- `series`
- `products` (transitional)
- `catalog_skus`
- `l1_intent_lines`
- `l1_attributes`
- `l1_line_groups`
- `l1_l2_mappings`

### MBOM Module (Master BOM)
- `master_boms`
- `master_bom_items`

### QUO Module (Quotation)
- `quotations`
- `quote_panels`
- `quote_boms`
- `quote_bom_items`
- `quotation_revisions` (if exists)
- `discount_rules`

### PRICING Module
- `price_lists`
- `sku_prices`
- `prices` (transitional)
- `import_batches` (if exists)
- `import_approval_queue` (if exists)

### TAX Module
- `tax_profiles`

### AUDIT Module (Cross-cutting)
- `audit_logs` (canonical name; `audit_log` if legacy exists)

### AI Module (Schema Reservation)
- `ai_call_logs`
- `ai_feedback_logs` (optional/reserved)
- `ai_models` / `model_registry` (optional/reserved)
- `ai_embeddings_cache` (optional/reserved)

### SHARED / CROSS-CUTTING
- `cost_heads`

⸻

## 4) Locked Cross-Module Contracts (Recap)

### PRICING ↔ QUO
- **Price truth vs snapshot (Policy-1):** PRICING owns `sku_prices` (append-only); QUO snapshots applied values in workspace (`quote_bom_items.rate`, `rate_source`)

### MBOM ↔ QUO
- **Copy-never-link:** QUO may reference `origin_master_bom_id` for traceability only; QUO owns workspace edits and deviation tracking

### CIM ↔ QUO
- **Reference only; CIM owns identity:** QUO references CIM entities but does not mutate CIM tables; CIM remains master owner

### CIM ↔ PRICING
- **SKU Identity Boundary:** CIM owns identity (`catalog_skus`, `makes`, `series`, `products` transitional); PRICING owns price rows (`sku_prices`)

### AUDIT
- **Append-only; written via logger:** All modules can produce audit events via `AuditLogger.log_event()`; AUDIT owns storage schema

### AI
- **Advisory only; non-blocking, non-authoritative:** AI/RAG is advisory only; cannot modify totals automatically; cannot bypass Policy-1

⸻

## 5) Freeze Gate Compliance

**Checklist Item:** A2.9 — Consolidated Ownership Matrix  
**Status:** ✅ VERIFIED  
**Approval:** ✅ APPROVED

**File saved:**  
`docs/PHASE_5/02_FREEZE_GATE/A2_Module_Ownership_Matrix/A2.9_Consolidated_Ownership_Matrix.md`

⸻

## 6) Evidence References

**Source Documents:**
- A2.1 — List All Tables in SPEC-5 Schema DDL
- A2.2 — AUTH Module Ownership
- A2.3 — CIM Module Ownership
- A2.4 — MBOM Module Ownership
- A2.5 — QUO Module Ownership
- A2.6 — PRICING Module Ownership
- A2.7 — AUDIT Module Ownership
- A2.8 — AI Module Ownership

**Schema Canon:**
- `backend/alembic/versions/*schema_canon*`

⸻

## Next Step

➡️ **A2.10** — Embed this consolidated matrix into the Data Dictionary (Step-1 deliverable) so ownership becomes part of the frozen spec.

