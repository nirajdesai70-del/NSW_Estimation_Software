# ✅ A2.3 — CIM Module Ownership Matrix

**Phase:** Phase-5  
**Category:** A — Freeze Gate Verification  
**Item:** A2.3  
**Status:** ✅ COMPLETED (Freeze-ready)  
**Date:** 2026-01-27  
**Purpose:** Lock table ownership, change authority, and responsibility boundaries for CIM (Catalog / Item Master) tables including taxonomy, attributes, make/series masters, and L1/L2 structures.

⸻

## 1) Ownership Rule (Canonical)

- **Each table has one primary owner module.**
- **Owner module is accountable for:**
  - schema changes
  - validation rules
  - write-path APIs
  - data integrity guarantees
- **Non-owner modules may read via foreign keys, but must not introduce write logic without owner approval.**

⸻

## 2) CIM Tables — Ownership & Responsibilities

### 2.1 Taxonomy / Hierarchy Masters

| Table | Primary Owner | Responsibility Scope | Write Authority | Key Constraints / Notes |
|-------|---------------|---------------------|-----------------|-------------------------|
| `categories` | CIM | Category master (tenant-scoped taxonomy root) | CIM only | `(tenant_id, code)` unique; drives classification and reporting |
| `subcategories` | CIM | Subcategory master under category | CIM only | tenant-scoped; should be constrained under category |
| `product_types` | CIM | Type / item-type master | CIM only | normalized type classification (preferred over display-only text fields) |

⸻

### 2.2 Attribute System (Master + Options)

| Table | Primary Owner | Responsibility Scope | Write Authority | Key Constraints / Notes |
|-------|---------------|---------------------|-----------------|-------------------------|
| `attributes` | CIM | Attribute definitions (codes, semantics, value type) | CIM only | attribute codes are canonical; shared across L1/L2 modeling |
| `attribute_options` | CIM | Enumerated attribute values | CIM only | supports dropdowns/controlled vocabulary |

⸻

### 2.3 Make/Series Masters

| Table | Primary Owner | Responsibility Scope | Write Authority | Key Constraints / Notes |
|-------|---------------|---------------------|-----------------|-------------------------|
| `makes` | CIM | OEM/Make master | CIM only | tenant-scoped OEM list; used for filtering and grouping |
| `series` | CIM | Series master for makes | CIM only | may be normalized or used as display; must remain consistent with v1.2 mapping |

⸻

### 2.4 Transitional Product Master (Legacy / Compatibility)

| Table | Primary Owner | Responsibility Scope | Write Authority | Key Constraints / Notes |
|-------|---------------|---------------------|-----------------|-------------------------|
| `products` | CIM (transitional) | Buyable product master (legacy bridge) | CIM only | treated as L2 commercial identity in current QUO tables (`quote_bom_items.product_id`); will later align with `catalog_skus` |

**Important Note (Locked):**  
Until full L2 migration is completed, `products` remains the binding entity used by QUO lines (`product_id`). CIM owns correctness of this master.

⸻

### 2.5 L2 Commercial SKU Layer (SKU-Pure)

| Table | Primary Owner | Responsibility Scope | Write Authority | Key Constraints / Notes |
|-------|---------------|---------------------|-----------------|-------------------------|
| `catalog_skus` | CIM | L2 SKU master (commercial identity) | CIM only | SKU-pure: one row per OEM catalog no; must not store engineering meaning |
| `sku_prices` | PRICING | Price history for L2 SKUs | PRICING only | append-only; referenced by CIM SKUs but owned by PRICING |

*(Ownership boundary: CIM owns SKU identity; PRICING owns price rows.)*

⸻

### 2.6 L1 Engineering Interpretation Layer

| Table | Primary Owner | Responsibility Scope | Write Authority | Key Constraints / Notes |
|-------|---------------|---------------------|-----------------|-------------------------|
| `l1_intent_lines` | CIM | L1 engineering meaning lines | CIM only | carries duty/rating/voltage/poles meaning through KVU or spec fields |
| `l1_attributes` | CIM | KVU attributes per L1 line | CIM only | canonical engineering meaning storage |
| `l1_line_groups` | CIM | grouping L1 base + feature lines | CIM only | supports structured interpretation sets |

⸻

### 2.7 L1 → L2 Mapping Layer

| Table | Primary Owner | Responsibility Scope | Write Authority | Key Constraints / Notes |
|-------|---------------|---------------------|-----------------|-------------------------|
| `l1_l2_mappings` | CIM | mapping L1 intent to L2 SKUs | CIM only | many-to-one allowed; must not enforce unique sku per L1 globally |

**Guardrail Link (Locked):**
- **G-08:** Reuse is allowed; multiple L1 lines may map to the same SKU/product identity.

⸻

## 3) Explicit Non-Goals (Prevent Scope Drift)

**CIM module does not own:**
- quotation workspaces (`quote_boms`, `quote_bom_items`, `panels`)
- pricing rules tables (`discount_rules`) (except for reading scope keys)
- audit logs
- tax profiles

**CIM provides the truth layer for taxonomy, attributes, and SKU identity, but does not control commercial discounting, quotation totals, or tax computation.**

⸻

## 4) Enforcement Expectations (Freeze Gate)

**Must be true in implementation:**
- CIM tables must be tenant-scoped where applicable (tenant isolation)
- Only CIM services/endpoints can create/update taxonomy, attributes, make/series, L1/L2 mapping records
- QUO module references CIM entities but does not mutate CIM tables
- PRICING module writes `sku_prices` but must not mutate `catalog_skus` identity

⸻

## 5) Evidence References (Where to Verify)

- **Schema canon migrations:** `backend/alembic/versions/*schema_canon*`
- **Catalog structures:** CREATE TABLE categories, catalog_skus, l1_*, l1_l2_mappings
- **Guards:** see Guardrails section (G-08 reuse)
- **v1.2 mapping:** `docs/PHASE_5/02_FREEZE_GATE/A2_Module_Ownership_Matrix/A2.1b_v1.2_Column_Coverage_Map.md`

⸻

## 6) Freeze Gate Compliance

**Freeze Gate Checklist Item:** A2.3 — CIM table ownership  
**Status:** ✅ VERIFIED  
**Approval:** ✅ APPROVED

⸻

## Next Task

➡️ **A2.4** — Map MBOM module tables (`master_boms`, `master_bom_items`)

