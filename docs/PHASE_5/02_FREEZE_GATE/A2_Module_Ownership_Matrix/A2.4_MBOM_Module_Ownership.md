# ✅ A2.4 — MBOM Module Ownership Matrix

**Phase:** Phase-5  
**Category:** A — Freeze Gate Verification  
**Item:** A2.4  
**Status:** ✅ COMPLETED (Freeze-ready)  
**Date:** 2026-01-27  
**Purpose:** Lock table ownership, change authority, and responsibility boundaries for MBOM (Master BOM) tables.

⸻

## 1) Ownership Rule (Canonical)

- **Each table has one primary owner module.**
- **Owner module is accountable for:**
  - schema changes
  - validation rules
  - write-path APIs
  - data integrity guarantees
- **Non-owner modules may read via foreign keys, but must not introduce write logic without owner approval.**

⸻

## 2) MBOM Tables — Ownership & Responsibilities

### 2.1 Master BOM Template Layer

| Table | Primary Owner | Responsibility Scope | Write Authority | Key Constraints / Notes |
|-------|---------------|---------------------|-----------------|-------------------------|
| `master_boms` | MBOM | Master BOM template header lifecycle | MBOM only | Tenant-scoped template entity; supports reuse across quotations |
| `master_bom_items` | MBOM | Master BOM template line items (L0/L1 only) | MBOM only | **G-01 applies:** `product_id` must be NULL; template purity enforced |

⸻

## 3) Locked Behavioral Contracts (MBOM ↔ QUO Boundary)

### 3.1 Copy-Never-Link (Template to Workspace)

**Rule (Locked):**
- Master BOMs are templates
- Quotation BOMs are workspaces
- Applying a Master BOM to a quotation must copy, never link live

**Implications:**
- QUO may store `origin_master_bom_id` as reference only
- Editing QUO copies must not mutate MBOM templates
- MBOM updates must not retroactively affect existing quotations

**Owner Responsibility:**
- **MBOM** owns template validity and reusability guarantees
- **QUO** owns workspace editability and instance tracking

⸻

### 3.2 Resolution Level Boundary (G-01 / G-02)

| Stage | Owner | Allowed Resolution | Product Binding |
|-------|-------|-------------------|-----------------|
| MBOM (Template) | MBOM | L0 / L1 | `product_id` MUST be NULL (G-01) |
| QUO (Workspace) | QUO | L0 / L1 / L2 | If L2 → `product_id` MUST be NOT NULL (G-02) |

**MBOM must never allow "production binding" in templates.**

⸻

## 4) Explicit Non-Goals (Prevent Scope Drift)

**MBOM module does not own:**
- quotation workspace tables (`quote_boms`, `quote_bom_items`, `quote_panels`)
- pricing tables or discount rules
- tax profiles
- audit tables

**MBOM is responsible only for:**
- template structure integrity
- template lifecycle management
- template-level validation guardrails

⸻

## 5) Enforcement Expectations (Freeze Gate)

**Must be true in implementation:**
- Only MBOM endpoints/services can create/update/delete `master_boms` and `master_bom_items`
- Master BOM items cannot store `product_id` (G-01)
- QUO must treat Master BOM as input template only (copy-never-link)
- Any "apply master BOM to quotation" workflow must not mutate MBOM records

⸻

## 6) Evidence References (Where to Verify)

- **Schema canon migrations:** `backend/alembic/versions/*schema_canon*`
- **Look for:** CREATE TABLE master_boms
- **Look for:** CREATE TABLE master_bom_items
- **Look for:** constraint enforcing `master_bom_items.product_id IS NULL` (G-01)
- **Guardrail reference:**
  - `docs/PHASE_5/02_FREEZE_GATE/A1_Validation_Guardrails/A1.2_Guardrail_G01_Master_BOM_Rejects_ProductId.md`
- **Copy-never-link rule:**
  - Data Dictionary: Business Rules section
  - QUO schema fields like `quote_boms.origin_master_bom_id` (A4 verification later)

⸻

## 7) Freeze Gate Compliance

**Freeze Gate Checklist Item:** A2.4 — MBOM table ownership  
**Status:** ✅ VERIFIED  
**Approval:** ✅ APPROVED

⸻

## Next Task

➡️ **A2.5** — Map QUO module tables (`quotations`, `quote_panels`, `quote_boms`, `quote_bom_items`, etc.)

