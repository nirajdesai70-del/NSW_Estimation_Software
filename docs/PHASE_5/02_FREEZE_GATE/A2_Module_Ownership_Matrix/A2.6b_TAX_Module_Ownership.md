# ✅ A2.6b — TAX Module Ownership Matrix

**Phase:** Phase-5  
**Category:** A — Freeze Gate Verification  
**Item:** A2.6b  
**Status:** ✅ COMPLETED (Freeze-ready)  
**Date:** 2026-01-27  
**Purpose:** Lock table ownership, write authority, and responsibility boundaries for TAX master tables used by quotation computation.

⸻

## 1) Ownership Rule (Canonical)

- **Each table has one primary owner module.**
- **Owner module is accountable for:**
  - schema changes
  - validation rules
  - write-path APIs
  - data integrity guarantees
- **Non-owner modules may read via foreign keys, but must not introduce write logic without owner approval.**

⸻

## 2) TAX Tables — Ownership & Responsibilities

| Table | Primary Owner | Responsibility Scope | Write Authority | Key Constraints / Notes |
|-------|---------------|---------------------|-----------------|-------------------------|
| `tax_profiles` | TAX | GST profile master (CGST/SGST/IGST component rates) | TAX only | Tenant-scoped. QUO selects via `quotations.tax_profile_id`; QUO snapshots applied rates on Apply-Recalc. |

⸻

## 3) Locked Behavioral Contracts (TAX ↔ Other Modules)

### 3.1 TAX ↔ QUO (Selection vs Snapshot Boundary)
- **TAX owns master profiles (`tax_profiles`).**
- **QUO owns workspace selection + snapshots:**
  - **Selection:** `quotations.tax_profile_id`, `quotations.tax_mode`
  - **Snapshots written on Apply-Recalc:** `taxable_base`, `*_pct_snapshot`, `*_amount`, `tax_amount_total`, `grand_total`
- **TAX changes affect future computations; QUO history changes only via explicit Apply-Recalc (Policy-1).**

### 3.2 TAX ↔ AUDIT
- TAX master edits (when implemented) should emit AUDIT events.
- AUDIT storage remains AUDIT-owned; TAX writes only through AuditLogger/AUDIT interface.

⸻

## 4) Explicit Non-Goals (Prevent Scope Drift)

**TAX module does not own:**
- quotation workspaces (`quotations`, `quote_bom_items`)
- pricing truth (`sku_prices`)
- discount rules (`discount_rules`)
- audit storage (`audit_logs`)

⸻

## 5) Enforcement Expectations (Freeze Gate)

**Must be true in implementation:**
- Only TAX endpoints/services can create/update/delete `tax_profiles`
- QUO consumes tax profiles via selection (`tax_profile_id`, `tax_mode`)
- QUO snapshots tax computation results on Apply-Recalc (Policy-1)
- TAX changes do not retroactively affect existing quotation snapshots

⸻

## 6) Evidence References (Where to Verify)

- **Schema migration:** `backend/alembic/versions/20260104_140000_create_tax_profiles.py`
- **QUO selection + snapshots:** `backend/alembic/versions/20260104_140100_add_tax_fields_to_quotations.py`
- **TAX endpoint:** `backend/app/api/v1/endpoints/tax.py`
- **Apply-Recalc snapshot write path:** `backend/app/api/v1/endpoints/quotation.py`

⸻

## 7) Freeze Gate Compliance

**Freeze Gate Checklist Item:** A2.6b — TAX table ownership  
**Status:** ✅ VERIFIED  
**Approval:** ✅ APPROVED

⸻

## Next Task

➡️ Continue A3 (Naming Conventions) or finish any remaining A2 cleanup items (if any)

