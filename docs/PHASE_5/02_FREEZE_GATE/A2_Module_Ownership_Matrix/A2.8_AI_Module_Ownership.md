# ✅ A2.8 — AI Module Ownership Matrix

**Phase:** Phase-5  
**Category:** A — Freeze Gate Verification  
**Item:** A2.8  
**Status:** ✅ COMPLETED (Freeze-ready)  
**Date:** 2026-01-27  
**Purpose:** Lock table ownership, change authority, and responsibility boundaries for AI-reserved tables (schema reservation in Phase-5, logic deferred).

⸻

## 1) Ownership Rule (Canonical)

- **Each table has one primary owner module.**
- **Owner module is accountable for:**
  - schema changes
  - validation rules
  - write-path APIs
  - data integrity guarantees
- **Non-owner modules may reference AI tables only through defined interfaces (or leave them unused if Phase-5 reservation only).**

⸻

## 2) AI Tables — Ownership & Responsibilities

**Phase-5 stance:** AI is schema-reservation only unless explicitly approved otherwise.

| Table | Primary Owner | Responsibility Scope | Write Authority | Key Constraints / Notes |
|-------|---------------|---------------------|-----------------|-------------------------|
| `ai_call_logs` (if exists) | AI | Logging of AI/RAG calls (prompt context, model, latency, success/failure, tokens if captured) | AI only (or system via AI service) | Must be tenant-scoped; do not store secrets; store references/ids, not raw sensitive payloads |
| `ai_feedback_logs` (optional/reserved) | AI | Human feedback signals on AI suggestions | AI only | Reserved for later (Phase-6/7) unless minimal logging is approved |
| `ai_models` / `model_registry` (optional/reserved) | AI | Model metadata, versions, deployment refs | AI only | Reserved; no runtime dependency in Phase-5 |
| `ai_embeddings_cache` (optional/reserved) | AI | If local embeddings caching is used | AI only | Usually deferred; must not become a hard dependency for pricing |

**If any AI tables are not present in schema today:**  
They remain AI-owned reserved tables (ownership is still locked, even if not yet created).

⸻

## 3) Locked Behavioral Contracts (AI ↔ Other Modules)

### 3.1 AI ↔ QUO / PRICING (Hard Boundary)
- **AI/RAG is advisory only.**
- **AI must never:**
  - modify totals automatically
  - overwrite rates/discounts/taxes
  - bypass Policy-1 (Preview ≠ Apply)

**Allowed AI behavior:**
- Explain why totals changed
- Suggest which rule likely applied
- Suggest missing data to resolve UNRESOLVED lines
- Provide "operator guidance" text

### 3.2 AI ↔ AUDIT
- AI operational logs are not the same as audit logs.
- AUDIT remains the canonical legal trace.
- AI tables are for observability + improvement only.

### 3.3 AI ↔ AUTH
- AI tables must be tenant-scoped.
- Actor attribution should use `user_id` (when available) but no AI schema should own RBAC.

⸻

## 4) Explicit Non-Goals (Prevent Scope Drift)

**AI module does not own:**
- quotation workspaces (`quotations`, `quote_bom_items`)
- pricing truth (`sku_prices`)
- discount rules (`discount_rules`)
- tax profiles (`tax_profiles`)
- audit storage (`audit_logs`)

**AI module owns only:**
- AI/RAG usage telemetry (if enabled)
- AI model metadata (if enabled)
- AI feedback loops (future)

⸻

## 5) Enforcement Expectations (Freeze Gate)

**Must be true in implementation:**
- AI is non-blocking: if AI is down, estimation must still run.
- AI is non-authoritative: cannot change money fields automatically.
- AI tables (if present) must be tenant-scoped and safe:
  - no secrets
  - no full raw prompt dumps if they include sensitive commercial data (store references/hashes/redacted text)

**Phase-5 default:**
- AI endpoints may exist, but the pricing/discount/tax engine cannot depend on them.

⸻

## 6) Evidence References (Where to Verify)

- **Schema canon migrations:** `backend/alembic/versions/*schema_canon*`
- **Search keys:** CREATE TABLE ai_call_logs, ai_
- **AI scope declarations:**
  - Data Dictionary "AI Scope Declaration" section (A7 work later)
- **RAG boundary reference (if present):**
  - `RAG_KB/RAG_RULEBOOK.md` (architecture)
- **Policy-1 boundary:**
  - `backend/app/api/v1/endpoints/quotation.py` (preview/apply separation)

⸻

## 7) Freeze Gate Compliance

**Freeze Gate Checklist Item:** A2.8 — AI table ownership  
**Status:** ✅ VERIFIED  
**Approval:** ✅ APPROVED

⸻

## Next Task

➡️ **A2.9** — Create the consolidated Ownership Matrix (single table listing all tables → owner module)

