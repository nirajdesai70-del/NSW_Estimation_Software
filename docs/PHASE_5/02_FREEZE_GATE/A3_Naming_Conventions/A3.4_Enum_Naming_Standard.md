✅ A3.4 — Enum Naming Standard (Freeze-Gate Spec)

Phase: Phase-5
Category: A — Freeze Gate Verification
Item: A3.4
Status: ✅ COMPLETED (Freeze-ready)
Date: 2026-01-27
Purpose: Lock canonical naming rules for enum-like columns and their allowed values so schema + code + docs stay consistent, searchable, and deterministic.

⸻

1) Canonical Rule Set (Locked)

EN1 — "Enum" definition (what counts)

A column is treated as enum-like if:
	•	it has a controlled vocabulary (finite allowed values), AND
	•	the system behavior depends on those values (validation, compute, workflow).

Examples in Phase-5: rate_source, tax_mode, resolution_status, discount_source, template_type, status.

⸻

EN2 — Enum-like column suffix rules

Enum-like columns MUST use one of these suffixes based on meaning:
	•	_status → lifecycle state (workflow/state machine)
Examples: status, resolution_status
	•	_type → classification type
Examples: template_type, mapping_type
	•	_mode → operating mode / branch logic
Examples: tax_mode
	•	_source → origin/derivation of a value
Examples: rate_source, discount_source
	•	_level → numeric/ordinal level semantics
Examples: level (for BOM hierarchy), or prefer *_level if ambiguous

Do not use free-text "status" fields without controlled vocabulary.

⸻

EN3 — Enum value casing and format

Enum values MUST be:
	•	UPPER_SNAKE_CASE (uppercase, underscore delimiter)
	•	No spaces, hyphens, or camelCase
	•	Stable and deterministic (avoid synonyms)

✅ Good:
	•	CGST_SGST, IGST
	•	PRICELIST, UNRESOLVED, FIXED_NO_DISCOUNT
	•	LINE (for discount_source)

❌ Not allowed:
	•	CgstSgst, igst
	•	fixed-no-discount, Fixed No Discount
	•	lineOverride

⸻

EN4 — Enum value semantics must be single-purpose

One enum value must represent one meaning only. Avoid overloading:
	•	✅ FIXED_NO_DISCOUNT means "fixed pricing, discount forbidden"
	•	❌ Don't reuse it to mean "manual fixed price" unless explicitly documented (we handled this by keeping it quotation-scoped fixed pricing and non-discountable; see A1.7 clarification).

⸻

EN5 — Storage strategy: controlled vocabulary must be enforced in DB

Enum-like columns MUST be enforced at the schema layer using one of:
	•	CHECK constraints (preferred in Phase-5 for portability)
	•	Native DB enums (allowed later if explicitly approved)

Rule: Never rely on "application-only" enforcement for enum values.

⸻

EN6 — Constraint naming for enum checks

Enum CHECK constraints MUST follow:

chk_<table>__<column>__enum

Examples:
	•	chk_quote_bom_items__rate_source__enum
	•	chk_quotations__tax_mode__enum
	•	chk_discount_rules__scope_type__enum

(Existing constraints already in migrations do not need renaming; apply this standard going forward.)

⸻

EN7 — Default values must be explicit and meaningful

If an enum-like column has a default, it MUST be:
	•	explicitly defined in schema, AND
	•	documented in Data Dictionary.

Examples:
	•	rate_source default UNRESOLVED ✅

Avoid "empty string" defaults.

⸻

EN8 — Cross-layer consistency (DB ↔ code ↔ docs)

For every enum-like column:
	•	Column name must match Data Dictionary and code.
	•	Allowed values must match across:
	•	schema CHECK constraint
	•	Python Enum (if used)
	•	API validation (Pydantic Literal/Enum)
	•	guardrail docs

No silent differences like: DB allows MANUAL_WITH_DISCOUNT but code uses MANUAL.

If the DB values differ from internal code values, use an explicit mapping layer (e.g., rate_source_map.py).

⸻

2) Examples (Aligned to Phase-5)

Example A — tax_mode
	•	Column: quotations.tax_mode
	•	Values: CGST_SGST, IGST
	•	Enforcement: CHECK constraint
	•	API: Literal "CGST_SGST" | "IGST"
	•	Engine: TaxMode enum (string values), deterministic.

Example B — rate_source
	•	Column: quote_bom_items.rate_source
	•	Values: PRICELIST, MANUAL_WITH_DISCOUNT, FIXED_NO_DISCOUNT, UNRESOLVED
	•	Enforcement: CHECK constraint
	•	Code uses RateSource enum + mapping layer if internal names differ.

Example C — discount_source
	•	Column: quote_bom_items.discount_source
	•	Values: LINE or NULL
	•	Enforcement: CHECK constraint (or strict schema validation)

⸻

3) Enforcement Expectations
	•	All new migrations MUST:
	1.	use enum-like suffix rules (EN2)
	2.	enforce values in DB (EN5)
	3.	name constraints using EN6 (for new constraints)
	4.	update the Data Dictionary if a new enum or enum value is introduced
	•	Any deviation MUST include:
	•	justification in migration header, and
	•	a note in Data Dictionary change log.

⸻

4) Freeze Gate Compliance

Checklist Item: A3.4 — Enum naming standard
Status: ✅ VERIFIED
Approval: ✅ APPROVED

