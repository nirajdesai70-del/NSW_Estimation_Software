# Final Plan: Adopt New v1.2 CLEAN Pipeline, Archive Old (No Migration)

**Date:** 2026-01-03  
**Status:** üü° EXECUTION IN PROGRESS  
**Strategy:** Single, gated execution path with strong traceability

---

## üéØ Goal

- **Canonical truth** = outputs generated by the new Phase-5 pipeline (v1.2 CLEAN rules)
- **Old outputs** = archived as historical reference only
- **No repair/migration** of old LC1E workbooks

**Freeze Rules:**
- `NSW_TERMINOLOGY_AND_LEVELS_FREEZE_v1.2_CLEAN.md`
- `NSW_SHEET_SET_INDEX_v1.2_CLEAN.md`

---

## Phase A ‚Äî Complete New Pipeline (Must finish before archiving old)

### A1) Build L2 (Step 3) ‚è≥ IN PROGRESS

**Command:**
```bash
cd /Volumes/T9/Projects/Projects/NSW_Estimation_Software/tools/catalog_pipeline_v2/active/schneider/LC1E

python3 ../../../scripts/lc1e_build_l2.py \
  --canonical 02_outputs/LC1E_CANONICAL_v1.xlsx \
  --pricelist_ref "WEF 15 Jul 2025" \
  --effective_from 2025-07-15 \
  --currency INR \
  --region INDIA \
  --out 02_outputs/LC1E_L2_tmp.xlsx
```

**Output:**
- `active/schneider/LC1E/02_outputs/LC1E_L2_tmp.xlsx`

**Gate:**
- [ ] Generic naming warnings reviewed (warning-only)
- [ ] Make/Series/Price are L2-only
- [ ] No capability tokens in SC_Lx

---

### A2) Derive L1 (Step 4)

**Command:**
```bash
python3 ../../../scripts/derive_l1_from_l2.py \
  --l2 02_outputs/LC1E_L2_tmp.xlsx \
  --l1_mode duty_x_voltage \
  --include_accessories true \
  --out 02_outputs/LC1E_L1_tmp.xlsx
```

**Output:**
- `active/schneider/LC1E/02_outputs/LC1E_L1_tmp.xlsx`

**Gate:**
- [ ] L1 remains vendor/series-neutral
- [ ] No coil voltage in L1 (SKU differentiator ‚Üí L2)

---

### A3) Build NSW Master Workbook (Step 5)

**Command:**
```bash
python3 ../../../scripts/build_nsw_workbook_from_canonical.py \
  --canonical 02_outputs/LC1E_CANONICAL_v1.xlsx \
  --l2 02_outputs/LC1E_L2_tmp.xlsx \
  --l1 02_outputs/LC1E_L1_tmp.xlsx \
  --out 02_outputs/NSW_LC1E_WEF_2025-07-15_v1.xlsx
```

**Output (canonical deliverable):**
- `active/schneider/LC1E/02_outputs/NSW_LC1E_WEF_2025-07-15_v1.xlsx`

**Gate:**
- [ ] Sheet set matches v1.2 CLEAN index intent
- [ ] SC_Lx = SCL only
- [ ] capability_codes used for capabilities
- [ ] Prices only in price matrix
- [ ] No OEM/series leakage into generic fields

---

### A4) QC (Step 6)

**Create:**
- `active/schneider/LC1E/03_qc/QC_SUMMARY.md`

**Gate:**
- [ ] Row counts recorded (canonical / L2 / L1 / NSW sheets)
- [ ] All warnings logged + decision noted

---

### A5) Governance Review (Step 7)

**Upload:**
- `NSW_LC1E_WEF_2025-07-15_v1.xlsx`
- `QC_SUMMARY.md`

**Outcome:**
- ‚úÖ approve freeze OR ‚ùå list fixes

**Gate:**
- [ ] ChatGPT approval received

---

## Phase B ‚Äî Archive Old Files (Only after Phase A gates pass)

### B1) Prepare Archive Structure ‚úÖ (Safe to do now)

**Command:**
```bash
cd /Volumes/T9/Projects/Projects/NSW_Estimation_Software/tools/catalog_pipeline_v2

mkdir -p archives/schneider/LC1E/OLD_PRE_V1.2_CLEAN/00_outputs
mkdir -p archives/schneider/LC1E/OLD_PRE_V1.2_CLEAN/01_docs
```

**Status:** ‚è≥ Ready to create (safe to do now)

---

### B2) Copy Old Artifacts (Non-Destructive)

**Only execute after Phase A5 (approval) passes**

**Command:**
```bash
# Copy (not move) all legacy outputs
cp output/lc1e/*.xlsx archives/schneider/LC1E/OLD_PRE_V1.2_CLEAN/00_outputs/ 2>/dev/null || true
cp output/NSW_MASTER_SCHNEIDER_WEF_2025-07-15_ENGINEER_REVIEW.xlsx archives/schneider/LC1E/OLD_PRE_V1.2_CLEAN/00_outputs/ 2>/dev/null || true
```

**Files to archive:**
- `output/lc1e/LC1E_*.xlsx` (old canonical, L1, L2, engineer review)
- `output/NSW_MASTER_SCHNEIDER_WEF_2025-07-15_ENGINEER_REVIEW.xlsx`
- Any old compat masters (only if confirmed obsolete)

**Gate:**
- [ ] All old files copied (not moved)
- [ ] Originals remain in place until validation complete

---

### B3) Archive README (Mandatory)

**Create:**
- `archives/schneider/LC1E/OLD_PRE_V1.2_CLEAN/README.md`

**Must include:**
- Reason: pre-v1.2 CLEAN, possible SC_Lx/capability confusion
- **DO NOT USE** statement
- Pointer to canonical path: `active/schneider/LC1E/02_outputs/NSW_LC1E_WEF_2025-07-15_v1.xlsx`

**Gate:**
- [ ] README created with DO NOT USE statement
- [ ] Canonical path documented

---

## Phase C ‚Äî Switch the Project Default (Make "new canonical" explicit)

### C1) Update Docs and References

**Action:** Search and replace references:
- `from output/lc1e/` ‚Üí `active/schneider/LC1E/02_outputs/`

**Files to check:**
- Documentation files
- README files
- Script comments

**Gate:**
- [ ] All references updated
- [ ] No internal docs point to `output/lc1e/` anymore

---

### C2) Optional Cleanup (Only after 1‚Äì2 successful cycles)

**Command:**
```bash
mkdir -p output/deprecated
mv output/lc1e output/deprecated/lc1e_old_$(date +%Y%m%d) 2>/dev/null || true
mv output/NSW_MASTER_SCHNEIDER_WEF_2025-07-15_ENGINEER_REVIEW.xlsx output/deprecated/ 2>/dev/null || true
```

**Note:** Do NOT delete immediately. Move to deprecated folder.

**Gate:**
- [ ] Old files moved to deprecated (not deleted)
- [ ] Only after 1-2 successful pipeline cycles

---

## üß≠ Execution Discipline

**Do NOT:**
- ‚ùå Archive old files yet (archive only after Step 5 + QC + approval)
- ‚ùå Update documentation paths yet (update only after final NSW workbook is approved)
- ‚ùå Touch old LC1E files (copy later, never edit)

**Do:**
- ‚úÖ Continue pipeline execution (Steps 3-8)
- ‚úÖ Create archive structure (B1 - safe to do now)
- ‚úÖ Wait for Phase A gates before Phase B

---

## ‚úÖ Success Criteria (Final)

You are "done" when:
- [ ] `active/.../NSW_LC1E_WEF_2025-07-15_v1.xlsx` exists and passes QC
- [ ] v1.2 CLEAN freeze docs are referenced
- [ ] Old outputs copied into archive with a DO NOT USE README
- [ ] No internal docs point to `output/lc1e/` anymore

---

## üìä Current Status

**Phase A Progress:**
- ‚úÖ A0: Input files prepared
- ‚úÖ A0: Step 2 - Canonical extraction complete and validated
- ‚è≥ A1: Step 3 - Build L2 (IN PROGRESS)
- ‚è∏Ô∏è A2: Step 4 - Derive L1 (waiting for A1)
- ‚è∏Ô∏è A3: Step 5 - Build NSW Master Workbook (waiting for A2)
- ‚è∏Ô∏è A4: Step 6 - QC (waiting for A3)
- ‚è∏Ô∏è A5: Step 7 - Governance Review (waiting for A4)

**Phase B Status:**
- ‚è∏Ô∏è B1: Archive structure (ready to create - safe now)
- ‚è∏Ô∏è B2: Copy old artifacts (waiting for Phase A completion)
- ‚è∏Ô∏è B3: Archive README (waiting for Phase A completion)

**Phase C Status:**
- ‚è∏Ô∏è C1: Update docs (waiting for Phase A completion)
- ‚è∏Ô∏è C2: Optional cleanup (waiting for 1-2 successful cycles)

---

**Next Action:** Execute Step 3 (Build L2) - see A1 above.
